# 知識庫「原始檔案 vs 分析後內容」功能說明

## 📖 功能概述

在知識庫中，每個上傳的檔案現在支援**兩種使用模式**：

1. **🎓 分析後內容**（預設）：使用 AI 學習後生成的精簡內容
2. **📄 原始檔案**：使用完整的原始檔案內容

您可以在**個別檔案**上自由切換這兩種模式。

---

## 🎯 使用場景

### 使用「分析後內容」的情況
- ✅ 大型文檔（超過 100KB）
- ✅ 需要快速理解重點
- ✅ 希望節省 token 使用量
- ✅ 提高對話響應速度

**範例**：
- UBL-DB-CI深度解析.md（3,997 行 PL/SQL）
- 系統架構文檔
- API 規範文檔

### 使用「原始檔案」的情況
- ✅ 需要完整的程式碼細節
- ✅ 需要精確的配置檔案內容
- ✅ 小型但重要的參考文檔
- ✅ 需要 AI 基於完整內容回答問題

**範例**：
- 配置檔案（config.json）
- SQL 腳本
- Shell 腳本
- 短小精悍的技術文檔

---

## 🔧 使用方式

### 1. 上傳檔案
1. 點擊「📤 上傳學習文件」
2. 選擇檔案上傳
3. 系統會自動：
   - 保存**原始內容**（originalContent）
   - 執行 AI **學習**（生成精簡內容）
   - 預設使用**分析後內容**

### 2. 切換使用模式

在知識庫列表中，每個**已學習**的檔案會顯示：

```
┌─────────────────────────────────────────┐
│ UBL-DB-CI深度解析.md                     │
│ ✅ 2026/01/07 12:30:45 已學習            │
│ 學習前: 250KB • 學習後: 45KB • 使用分析後 │
│                                         │
│ [✓] 提供給 AI   [ ] 📄 原始檔案         │ ← 切換按鈕
│ [忘記] [查看內容]                        │
└─────────────────────────────────────────┘
```

**切換步驟**：
1. 找到要切換的檔案
2. 點擊「📄 原始檔案」/ 「🎓 分析後」切換按鈕
3. 勾選 ✓ → 使用原始檔案
4. 取消勾選 → 使用分析後內容

### 3. 查看當前狀態

檔案資訊會顯示當前使用模式：
- **使用分析後**：綠色文字（#7bbda4）
- **使用原始檔**：紫色文字（#b89bdb）

---

## 📊 大小計算

系統會正確計算「使用中大小」：

```typescript
if (useOriginalContent) {
  使用大小 = originalSize  // 原始檔案大小
} else {
  使用大小 = learnedSize   // 學習後大小
}
```

**範例**：

| 檔案名稱 | 原始大小 | 學習後大小 | 當前模式 | 使用大小 |
|---------|---------|-----------|---------|---------|
| config.json | 5KB | 2KB | 📄 原始檔案 | **5KB** |
| UBL-DB-CI.md | 250KB | 45KB | 🎓 分析後 | **45KB** |
| README.md | 10KB | 4KB | 🎓 分析後 | **4KB** |

**總使用大小**：5KB + 45KB + 4KB = **54KB**

---

## ⚠️ 注意事項

### 1. 只有已學習的檔案才能切換
- 未學習的檔案：沒有切換按鈕
- 原因：必須先完成學習才有「分析後內容」

### 2. 原始內容必須存在
- 如果 `originalContent` 不存在，切換按鈕不會顯示
- 舊版本上傳的檔案可能沒有保存原始內容

### 3. Token 使用量
- 使用原始檔案會增加 token 使用量
- 注意模型的知識庫大小限制

### 4. 預設行為
- 新上傳的檔案預設使用「分析後內容」
- 確保最佳的效能和響應速度

---

## 🔍 實際應用案例

### 案例 1：UBL 系統文檔管理

**背景**：您上傳了 7 個 UBL 深度解析文檔，總共約 1.5MB

**策略**：
1. **使用分析後**（推薦）：
   - UBL-DB-CI深度解析.md (250KB → 45KB)
   - UBL-DB-BI深度解析.md (180KB → 35KB)
   - UBL-BATCH深度解析.md (200KB → 40KB)
   - **總使用大小**：~120KB

2. **使用原始檔案**（不推薦）：
   - 總使用大小：1.5MB
   - 可能超出模型限制
   - 對話速度變慢

**結論**：使用「分析後內容」可節省 **92% 的空間**

---

### 案例 2：混合使用策略

**背景**：您需要 AI 協助開發，同時需要查看配置檔案

**策略**：
| 檔案類型 | 使用模式 | 原因 |
|---------|---------|------|
| 大型文檔（UBL-*.md） | 🎓 分析後 | 節省空間，提取重點 |
| 配置檔案（config.json） | 📄 原始檔案 | 需要完整配置 |
| SQL 腳本（schema.sql） | 📄 原始檔案 | 需要精確的 SQL 語法 |
| API 文檔（api-doc.md） | 🎓 分析後 | 重點摘要即可 |

**總使用大小**：
- 分析後（120KB）+ 原始檔案（15KB）= **135KB**
- 遠低於模型限制（150KB）

---

## 🛠️ 技術實現

### 資料結構

```typescript
interface KnowledgeEntry {
  id: string
  name: string
  content: string              // 分析後內容
  originalContent?: string     // 原始內容
  useOriginalContent?: boolean // 切換標記
  size: number                 // 原始大小
  learnedSize?: number         // 學習後大小
  isLearned: boolean
  // ...
}
```

### 切換邏輯

```typescript
// 獲取活躍知識時，根據標記返回對應內容
getActiveKnowledge(): KnowledgeEntry[] {
  return activeEntries.map(entry => {
    if (entry.useOriginalContent && entry.originalContent) {
      return {
        ...entry,
        content: entry.originalContent,  // 使用原始內容
        size: entry.originalSize || entry.size
      }
    }
    return { ...entry }  // 使用分析後內容
  })
}
```

---

## 📝 常見問題

### Q1: 切換後需要重新學習嗎？
**A**: 不需要。切換只是改變使用哪個內容版本，不會影響已學習的內容。

### Q2: 可以批次切換嗎？
**A**: 目前需要逐個檔案切換。未來可能增加批次操作功能。

### Q3: 切換後對話歷史會受影響嗎？
**A**: 不會。只影響**新對話**時提供給 AI 的知識內容。

### Q4: 如何知道當前使用哪種模式？
**A**: 檔案資訊行會顯示「使用原始檔」（紫色）或「使用分析後」（綠色）。

### Q5: 原始內容會佔用多少存儲空間？
**A**: 原始內容存儲在 localStorage 中，瀏覽器限制通常為 5-10MB。建議定期匯出備份。

---

## 🎉 功能優勢

1. **靈活性**：可以根據需求自由切換
2. **效能優化**：預設使用分析後內容，節省 token
3. **完整性保留**：隨時可以切換回原始檔案
4. **個別控制**：每個檔案獨立設定，不影響其他檔案
5. **透明化**：清楚顯示當前使用模式和大小資訊

---

## 📅 更新日誌

### v1.0.0 (2026-01-07)
- ✅ 實現「原始檔案 vs 分析後內容」切換功能
- ✅ 增加 `useOriginalContent` 標記
- ✅ UI 增加切換按鈕
- ✅ 統計資訊正確計算使用大小
- ✅ 上傳時自動保存原始內容

---

**提示**：如有任何問題或建議，歡迎回饋！
