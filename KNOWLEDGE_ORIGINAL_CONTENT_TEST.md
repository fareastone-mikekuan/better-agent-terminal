# 知識庫「原始檔案 vs 分析後內容」功能測試清單

## ✅ 測試項目

### 1. 檔案上傳
- [ ] 上傳新檔案後，`originalContent` 正確保存
- [ ] 上傳新檔案後，預設 `useOriginalContent = undefined` (使用分析後內容)
- [ ] 上傳後自動學習功能正常
- [ ] `originalSize` 正確記錄

### 2. UI 顯示
- [ ] 已學習且有 `originalContent` 的檔案顯示切換按鈕
- [ ] 未學習的檔案不顯示切換按鈕
- [ ] 沒有 `originalContent` 的檔案不顯示切換按鈕
- [ ] 切換按鈕狀態正確顯示（✓ = 使用原始檔案）
- [ ] 檔案資訊行正確顯示當前模式（「使用原始檔」或「使用分析後」）
- [ ] 顏色區分正確（紫色 = 原始，綠色 = 分析後）

### 3. 切換功能
- [ ] 點擊切換按鈕可以正常切換
- [ ] 切換後 localStorage 正確保存
- [ ] 切換後 UI 立即更新
- [ ] 多次切換不會出錯

### 4. 統計資訊
- [ ] 使用原始內容時，「使用中大小」使用 `originalSize`
- [ ] 使用分析後內容時，「使用中大小」使用 `learnedSize`
- [ ] 總使用率計算正確
- [ ] 混合使用原始和分析後內容時，統計正確

### 5. AI 對話
- [ ] 使用原始內容時，AI 收到完整原始內容
- [ ] 使用分析後內容時，AI 收到學習後內容
- [ ] 切換後新對話使用正確的內容
- [ ] 舊對話歷史不受影響

### 6. 邊界情況
- [ ] 大檔案（>500KB）正常處理
- [ ] 小檔案（<10KB）正常處理
- [ ] 特殊字元檔案名正常處理
- [ ] 中文檔案名正常處理
- [ ] 空內容檔案正常處理

### 7. 持久化
- [ ] 重啟應用後設定保留
- [ ] 重啟應用後 `useOriginalContent` 狀態正確
- [ ] 匯出功能包含 `useOriginalContent` 標記
- [ ] 匯入功能正確恢復 `useOriginalContent` 標記

### 8. 效能
- [ ] 切換不會造成 UI 卡頓
- [ ] 大量檔案時切換正常
- [ ] localStorage 容量在合理範圍內

---

## 🧪 測試案例

### 案例 1：基本切換流程
1. 上傳檔案 `test.md` (100KB)
2. 等待學習完成（假設學習後 20KB）
3. 檢查預設使用「分析後內容」
4. 點擊切換按鈕，勾選「原始檔案」
5. 驗證：
   - [ ] 檔案資訊顯示「使用原始檔」（紫色）
   - [ ] 使用中大小增加 80KB (100KB - 20KB)
   - [ ] 切換按鈕顯示 ✓

### 案例 2：混合使用策略
1. 上傳 3 個檔案：
   - `large.md` (500KB → 學習後 50KB)
   - `medium.md` (100KB → 學習後 20KB)
   - `config.json` (5KB → 學習後 2KB)
2. 設定：
   - `large.md`: 使用分析後
   - `medium.md`: 使用分析後
   - `config.json`: 使用原始檔案
3. 驗證：
   - [ ] 使用中大小 = 50KB + 20KB + 5KB = 75KB
   - [ ] 統計資訊正確
   - [ ] AI 對話時，`config.json` 提供完整內容

### 案例 3：來回切換
1. 上傳檔案 `test.md`
2. 學習完成後切換到「原始檔案」
3. 再切換回「分析後」
4. 重複 5 次
5. 驗證：
   - [ ] 每次切換都正常
   - [ ] 無記憶體洩漏
   - [ ] localStorage 正常

### 案例 4：舊檔案遷移
1. 使用舊版本上傳檔案（沒有 `originalContent`）
2. 升級到新版本
3. 驗證：
   - [ ] 不顯示切換按鈕（因為沒有 `originalContent`）
   - [ ] 系統正常運作
   - [ ] 不會出錯

---

## 🐛 已知問題

### 問題 1：舊檔案沒有 originalContent
**影響**：在新版本之前上傳的檔案無法切換到原始內容
**解決方案**：提示使用者重新上傳，或提供「重新提取原始內容」功能

### 問題 2：localStorage 容量限制
**影響**：大量大檔案可能超出 localStorage 限制（5-10MB）
**解決方案**：建議定期匯出，或提供清理舊檔案功能

---

## 📊 測試結果記錄

| 測試項目 | 狀態 | 備註 | 測試日期 |
|---------|------|------|---------|
| 檔案上傳 | ⏳ 待測試 | | |
| UI 顯示 | ⏳ 待測試 | | |
| 切換功能 | ⏳ 待測試 | | |
| 統計資訊 | ⏳ 待測試 | | |
| AI 對話 | ⏳ 待測試 | | |
| 邊界情況 | ⏳ 待測試 | | |
| 持久化 | ⏳ 待測試 | | |
| 效能 | ⏳ 待測試 | | |

---

## 🔧 測試環境

- **OS**: macOS / Windows / Linux
- **Browser**: Chrome / Safari / Edge
- **App Version**: v1.25.x
- **Node.js**: v18+
- **Electron**: v28+

---

## 📝 測試報告模板

```markdown
## 測試報告

**測試日期**：2026-01-07
**測試人員**：[姓名]
**測試環境**：macOS 14.0 / Chrome 120

### 測試結果
- ✅ 通過：8/8
- ❌ 失敗：0/8
- ⚠️ 部分通過：0/8

### 發現問題
1. [無]

### 建議改進
1. [無]

### 總結
功能運作正常，建議正式發布。
```

---

**備註**：請在測試完成後更新此文檔。
